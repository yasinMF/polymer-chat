<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="mf-chat-imports.html">

<dom-module id="mf-chat-app">
	<template>
		<style include="shared-styles">
			:host {
				display: block;
				position: absolute;
				top: 0px;
				left: 0px;
				right: 0px;
				bottom: 0px;
				background-color: var(--dark-background-color);
			}



		</style>

		<app-location route="{{route}}"></app-location>
		<app-route
			route="{{route}}"
			pattern="/:page"
			data="{{routeData}}"
			tail="{{subroute}}"></app-route>

		<firebase-app 
			name="mf-chat"
			auth-domain="mf-chat.firebaseapp.com"
			database-url="https://mf-chat.firebaseio.com"
			api-key="AIzaSyDhe3nJPYEnjtGhMQmMNTFWbGSxMcqfIqM">
		</firebase-app>


		<iron-pages class="fullbleed" selected="[[_getCurrentPage(signedIn, statusKnown, routeData.page)]]" attr-for-selected="name" fallback-selection="[[_getFallbackPage(signedIn, statusKnown)]]">

			<mf-chat-login user="{{user}}" status-known="{{statusKnown}}" signed-in="{{signedIn}}" name="login"></mf-chat-login>

			<mf-chat-layout name="home" user="{{user}}"></mf-chat-layout>


		</iron-pages>

	</template>

	<script>
		Polymer({
			is: 'mf-chat-app',

			observers:[
				'_userChanged(user.uid, signedIn, statusKnown)'
			],

			_userChanged:function(userId, signedIn, statusKnown){
				console.log('user changed', userId);
				if(userId && (this.routeData.page == 'login' || !this.routeData.page)){
					this.set('route.path', 'home')
				}
			},

			_getFallbackPage:function(signedIn, statusKnown){
				return this._shouldShowLogin(signedIn, statusKnown) ? 'login' : 'home';
			},

			_getCurrentPage:function(signedIn, statusKnown, page){
				return this._shouldShowLogin(signedIn, statusKnown) ? 'login' : 'home';
			},

			_shouldShowLogin:function(signedIn, statusKnown){
				return !signedIn && statusKnown ? true : false;
			},

		});
	</script>
</dom-module>
